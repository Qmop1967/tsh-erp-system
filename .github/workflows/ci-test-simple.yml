name: CI Test - Simple

on:
  push:
    branches:
      - develop
  workflow_dispatch:

jobs:
  test-basic:
    name: Basic CI Test
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Test secret configuration
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          PROD_DB_USER: ${{ secrets.PROD_DB_USER }}
        run: |
          echo "Testing CI/CD System..."
          echo "Checking secrets..."

          if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
            echo "❌ TELEGRAM_BOT_TOKEN not set"
            exit 1
          else
            echo "✅ TELEGRAM_BOT_TOKEN is set"
          fi

          if [ -z "$TELEGRAM_CHAT_ID" ]; then
            echo "❌ TELEGRAM_CHAT_ID not set"
            exit 1
          else
            echo "✅ TELEGRAM_CHAT_ID is set"
          fi

          if [ -z "$PROD_DB_USER" ]; then
            echo "❌ PROD_DB_USER not set"
            exit 1
          else
            echo "✅ PROD_DB_USER is set"
          fi

          echo "✅ All critical secrets configured!"

      - name: Test Python environment
        run: |
          python3 --version
          pip3 --version

      - name: Send Telegram notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          TEXT="CI Test Successful - Workflow: CI Test Simple - Branch: develop - Commit: ${{ github.sha }} - All checks passed"

          curl -s "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${CHAT_ID}" \
            -d "text=${TEXT}" > /dev/null

          echo "✅ Telegram notification sent!"
