name: CI Test - Simple

on:
  push:
    branches:
      - develop
  workflow_dispatch:

jobs:
  test-basic:
    name: Basic CI Test
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Test secret configuration
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          PROD_DB_USER: ${{ secrets.PROD_DB_USER }}
        run: |
          echo "Testing CI/CD System..."
          echo "Checking secrets..."

          if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
            echo "âŒ TELEGRAM_BOT_TOKEN not set"
            exit 1
          else
            echo "âœ… TELEGRAM_BOT_TOKEN is set"
          fi

          if [ -z "$TELEGRAM_CHAT_ID" ]; then
            echo "âŒ TELEGRAM_CHAT_ID not set"
            exit 1
          else
            echo "âœ… TELEGRAM_CHAT_ID is set"
          fi

          if [ -z "$PROD_DB_USER" ]; then
            echo "âŒ PROD_DB_USER not set"
            exit 1
          else
            echo "âœ… PROD_DB_USER is set"
          fi

          echo "âœ… All critical secrets configured!"

      - name: Test Python environment
        run: |
          python3 --version
          pip3 --version

      - name: Send Telegram notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          MESSAGE="âœ… *CI Test Successful!*

*Workflow:* CI Test - Simple
*Branch:* develop
*Commit:* ${{ github.sha }}

*Checks Passed:*
â€¢ Secret configuration âœ…
â€¢ Python environment âœ…
â€¢ Basic workflow execution âœ…

ðŸ¤– _GitHub Actions CI/CD_"

          curl -s "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${CHAT_ID}" \
            -d "parse_mode=Markdown" \
            -d "text=${MESSAGE}" > /dev/null

          echo "âœ… Telegram notification sent!"
